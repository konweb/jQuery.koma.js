"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}();!function(){var t=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),i=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow),n=function(){return i&&i.call(performance)||(new Date).getTime()},e=function(){function i(t,e){_classCallCheck(this,i),this.option=$.extend({fps:20,step:null,itemEl:".koma-items",restartEl:".koma-restart",stopEl:".koma-stop"},e),this.$el=t,this.$img=this.$el.find(this.option.itemEl+" img"),this.$item=this.$el.find(this.option.itemEl),this.$restart=this.$el.find(this.option.restartEl),this.$stop=this.$el.find(this.option.stopEl),this.imgLen=this.$img.length,this.startTime=n(),this.animationFlag=!0,this.setup()}return _createClass(i,[{key:"setup",value:function(){var t=this;this.$img.slice(1).hide(),this.imgLoad().then(function(){t.animation(),t.eventify()})["catch"](function(){console.log("画像読み込み失敗")})}},{key:"eventify",value:function(){var i=this;console.log("eventify"),this.$stop.on("click",function(){console.log("stop"),window.cancelAnimationFrame(i.requestId)}),this.$restart.on("click",function(){console.log("restart"),i.requestId=t(i.animation.bind(i))})}},{key:"imgLoad",value:function(){var t=[];return this.$img.each(function(){var i=new Image;i.src=$(this).attr("src");var n=new Promise(function(t,n){i.onload=function(){t()},i.error=function(){n()}});t.push(n)}),Promise.all(t)}},{key:"animation",value:function(){this.requestId=t(this.animation.bind(this));var i=n(),e=Math.floor((i-this.startTime)/(1e3/this.option.fps)%this.imgLen);this.$img.hide(),this.$img.slice(e-1,e).show()}}]),i}();$.fn.koma=function(t){var i=this;return this.each(function(){new e($(i),t)})}}();