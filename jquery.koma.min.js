"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();!function(){var t=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),i=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow),e=function(){return i&&i.call(performance)||(new Date).getTime()},n=function(){function i(t,n){_classCallCheck(this,i),this.option=$.extend({fps:20,step:null,itemEl:".koma-items",restartEl:".koma-restart",stopEl:".koma-stop"},n),this.$el=t,this.$img=this.$el.find(this.option.itemEl+" img"),this.$item=this.$el.find(this.option.itemEl),this.$restart=this.$el.find(this.option.restartEl),this.$stop=this.$el.find(this.option.stopEl),this.imgLen=this.$img.length,this.startTime=e(),this.animationFlag=!0,this.setup()}return _createClass(i,[{key:"setup",value:function(){var t=this;this.$img.slice(1).hide(),this.imgLoad().then(function(){t.animation(),t.eventify()})["catch"](function(){console.log("画像読み込み失敗")})}},{key:"eventify",value:function(){var i=this,e=new $.Event("koma_stop"),n=new $.Event("koma_restart");this.$stop.on("click",function(){window.cancelAnimationFrame(i.requestId),i.$el.trigger(e,{$el:i.$el})}),this.$restart.on("click",function(){i.requestId=t(i.animation.bind(i)),i.$el.trigger(n,{$el:i.$el})})}},{key:"imgLoad",value:function(){var t=[];return this.$img.each(function(){var i=new Image;i.src=$(this).attr("src");var e=new Promise(function(t,e){i.onload=function(){t()},i.error=function(){e()}});t.push(e)}),Promise.all(t)}},{key:"animation",value:function(){this.requestId=t(this.animation.bind(this));var i=e(),n=Math.floor((i-this.startTime)/(1e3/this.option.fps)%this.imgLen);this.$img.hide(),this.$img.slice(n-1,n).show()}}]),i}();$.fn.koma=function(t){var i=this;return this.each(function(){new n($(i),t)})}}();