"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(){var t=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),e=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow),i=function(){return e&&e.call(performance)||(new Date).getTime()},n=function(){function e(t,n){_classCallCheck(this,e),this.option=$.extend({fps:20,step:null,itemEl:".koma-items",restartEl:".koma-restart",stopEl:".koma-stop"},n),this.$el=t,this.$img=this.$el.find(this.option.itemEl+" img"),this.$item=this.$el.find(this.option.itemEl),this.$restart=this.$el.find(this.option.restartEl),this.$stop=this.$el.find(this.option.stopEl),this.imgLen=this.$img.length,this.startTime=i(),this.animationFlag=!0,this.setup()}return _createClass(e,[{key:"setup",value:function(){var t=this;this.$img.slice(1).hide(),this.imgLoad().then(function(){t.animation(),t.eventify()})["catch"](function(){console.log("画像読み込み失敗")})}},{key:"eventify",value:function(){var e=this,i=new $.Event("koma_stop"),n=new $.Event("koma_restart");this.$stop.on("click",function(){window.cancelAnimationFrame(e.requestId),e.$el.trigger(i,{$el:e.$el})}),this.$restart.on("click",function(){e.requestId=t(e.animation.bind(e)),e.$el.trigger(n,{$el:e.$el})})}},{key:"imgLoad",value:function(){var t=[];return this.$img.each(function(){var e=new Image;e.src=$(this).attr("src");var i=new Promise(function(t,i){e.onload=function(){t()},e.error=function(){i()}});t.push(i)}),Promise.all(t)}},{key:"animation",value:function(){this.requestId=t(this.animation.bind(this));var e=i(),n=Math.floor((e-this.startTime)/(1e3/this.option.fps)%this.imgLen);0===n&&(n=1),this.$img.hide().slice(n-1,n).show()}}]),e}();$.fn.koma=function(t){var e=this;return this.each(function(){new n($(e),t)})}}();